<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Computes the CMPS score of a comparison between two bullet profiles/signatures — extract_feature_cmps • CMPS</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Computes the CMPS score of a comparison between two bullet profiles/signatures — extract_feature_cmps" />
<meta property="og:description" content="Compute the Congruent Matching Profile Segments (CMPS) score based on two bullet profiles/signatures.
The reference profile will be divided into consecutive, non-overlapping, basis segments of the same length.
Then the number of segments that are congruent matching will be found as the CMPS score.
By default, extract_feature_cmps implements the algorithm with multi-peak insepction at three
different segment scales. By setting seg_scale_max = 1, users can switch to the algorithm
with multi-peak inspection at the basis scale only." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CMPS</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Computes the CMPS score of a comparison between two bullet profiles/signatures</h1>
    
    <div class="hidden name"><code>extract_feature_cmps.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Compute the Congruent Matching Profile Segments (CMPS) score based on two bullet profiles/signatures.
The reference profile will be divided into consecutive, non-overlapping, basis segments of the same length.
Then the number of segments that are congruent matching will be found as the CMPS score.
By default, <code>extract_feature_cmps</code> implements the algorithm with multi-peak insepction at three
different segment scales. By setting <code>seg_scale_max = 1</code>, users can switch to the algorithm
with multi-peak inspection at the basis scale only.</p>
    </div>

    <pre class="usage"><span class='fu'>extract_feature_cmps</span>(
  <span class='no'>x</span>,
  <span class='no'>y</span>,
  <span class='kw'>seg_length</span> <span class='kw'>=</span> <span class='fl'>50</span>,
  <span class='kw'>seg_scale_max</span> <span class='kw'>=</span> <span class='fl'>3</span>,
  <span class='kw'>Tx</span> <span class='kw'>=</span> <span class='fl'>25</span>,
  <span class='kw'>npeaks.set</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>5</span>, <span class='fl'>3</span>, <span class='fl'>1</span>),
  <span class='kw'>full_result</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>a numeric vector, vector of the reference bullet signature/profile that will be divided into basis segments</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>a numeric vector, vector of the comparison bullet signature/profile</p></td>
    </tr>
    <tr>
      <th>seg_length</th>
      <td><p>integer, integer, the length of a basis segment</p></td>
    </tr>
    <tr>
      <th>seg_scale_max</th>
      <td><p>integer, the maximum scale of the segment.</p><ul>
<li><p>If setting <code>seg_scale_max = 1</code>, the algorithm uses multi-peak inspection only at the basis scale;</p></li>
<li><p>If setting <code>seg_scale_max</code> to be an integer greater than 1, the algorithm uses multi-peak inspection at
different segment scales.</p></li>
<li><p>By default, <code>seg_scale_max = 3</code>. Increasing <code>seg_scale_max</code> will reduce the number of false positive results</p></li>
</ul></td>
    </tr>
    <tr>
      <th>Tx</th>
      <td><p>integer, the tolerance zone is <code>+/- Tx</code></p></td>
    </tr>
    <tr>
      <th>npeaks.set</th>
      <td><p>a numeric vector, specify the number of peaks to be found for each different scale of segment. The
number of peaks for the highest segment scale must be 1, i.e., the very last element of <code>npeaks.set</code> must be 1.</p></td>
    </tr>
    <tr>
      <th>full_result</th>
      <td><p>boolean, whether or not to return the full CMPS result</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>integer or a list</p><ul>
<li><p>if <code>full_result = FALSE</code>, return the CMPS number only</p></li>
<li><p>if <code>full_result = TRUE</code>, return a list of four elements:</p><ul>
<li><p><code>CMPS.score</code>: computed CMPS score</p></li>
<li><p><code>rec.position</code>: the recommended position that results in the CMPS score</p></li>
<li><p><code>pos.df</code>: a dataframe that includes all positions and their corresponding CMPS score</p></li>
<li><p><code>nseg</code>: the number of basis segments obtained from the reference profile</p></li>
</ul></li>
</ul>

    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Chen, Zhe, Wei Chu, Johannes A Soons, Robert M Thompson, John Song,
and Xuezeng Zhao. 2019. “Fired Bullet Signature Correlation Using the
Congruent Matching Profile Segments (CMPS) Method.” Forensic Science
International, December, #109964. https://doi.org/10.1016/j.forsciint.2019.109964.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>bulletxtrctr</span>)
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>tidyverse</span>)</div><div class='output co'>#&gt; <span class='message'>-- <span style='font-weight: bold;'>Attaching packages</span><span> --------------------------------------------------------------------- tidyverse 1.3.0 --</span></div><div class='output co'>#&gt; <span class='message'></span><span style='color: #00BB00;'>v</span><span> </span><span style='color: #0000BB;'>ggplot2</span><span> 3.3.0     </span><span style='color: #00BB00;'>v</span><span> </span><span style='color: #0000BB;'>purrr  </span><span> 0.3.3</span>
#&gt; <span class='message'></span><span style='color: #00BB00;'>v</span><span> </span><span style='color: #0000BB;'>tibble </span><span> 2.1.3     </span><span style='color: #00BB00;'>v</span><span> </span><span style='color: #0000BB;'>dplyr  </span><span> 0.8.5</span>
#&gt; <span class='message'></span><span style='color: #00BB00;'>v</span><span> </span><span style='color: #0000BB;'>tidyr  </span><span> 1.0.2     </span><span style='color: #00BB00;'>v</span><span> </span><span style='color: #0000BB;'>stringr</span><span> 1.4.0</span>
#&gt; <span class='message'></span><span style='color: #00BB00;'>v</span><span> </span><span style='color: #0000BB;'>readr  </span><span> 1.3.1     </span><span style='color: #00BB00;'>v</span><span> </span><span style='color: #0000BB;'>forcats</span><span> 0.5.0</span></div><div class='output co'>#&gt; <span class='message'>-- </span><span style='font-weight: bold;'>Conflicts</span><span> ------------------------------------------------------------------------ tidyverse_conflicts() --</span>
#&gt; <span class='message'></span><span style='color: #BB0000;'>x</span><span> </span><span style='color: #0000BB;'>dplyr</span><span>::</span><span style='color: #00BB00;'>filter()</span><span> masks </span><span style='color: #0000BB;'>stats</span><span>::filter()</span>
#&gt; <span class='message'></span><span style='color: #BB0000;'>x</span><span> </span><span style='color: #0000BB;'>dplyr</span><span>::</span><span style='color: #00BB00;'>lag()</span><span>    masks </span><span style='color: #0000BB;'>stats</span><span>::lag()</span></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>x3ptools</span>)
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>CMPS</span>)

<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='st'>"bullets"</span>)
<span class='no'>land2_3</span> <span class='kw'>&lt;-</span> <span class='no'>bullets</span>$<span class='no'>sigs</span>[<span class='no'>bullets</span>$<span class='no'>bulletland</span> <span class='kw'>==</span> <span class='st'>"2-3"</span>]<span class='kw'>[[</span><span class='fl'>1</span>]]
<span class='no'>land1_2</span> <span class='kw'>&lt;-</span> <span class='no'>bullets</span>$<span class='no'>sigs</span>[<span class='no'>bullets</span>$<span class='no'>bulletland</span> <span class='kw'>==</span> <span class='st'>"1-2"</span>]<span class='kw'>[[</span><span class='fl'>1</span>]]

<span class='co'># compute cmps</span>

<span class='co'># algorithm with multi-peak insepction at three different segment scales</span>
<span class='no'>cmps_with_multi_scale</span> <span class='kw'>&lt;-</span> <span class='fu'>extract_feature_cmps</span>(<span class='no'>land2_3</span>$<span class='no'>sig</span>, <span class='no'>land1_2</span>$<span class='no'>sig</span>, <span class='kw'>full_result</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)

<span class='co'># algorithm with multi-peak inspection at the basis scale only</span>
<span class='no'>cmps_without_multi_scale</span> <span class='kw'>&lt;-</span> <span class='fu'>extract_feature_cmps</span>(<span class='no'>land2_3</span>$<span class='no'>sig</span>, <span class='no'>land1_2</span>$<span class='no'>sig</span>, <span class='kw'>seg_scale_max</span> <span class='kw'>=</span> <span class='fl'>1</span>,
                                                 <span class='kw'>npeaks.set</span> <span class='kw'>=</span> <span class='fl'>5</span>, <span class='kw'>full_result</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)
<span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>tidyverse</span>)
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>bulletxtrctr</span>)

<span class='no'>lands</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span>(<span class='no'>bullets</span>$<span class='no'>bulletland</span>)

<span class='no'>comparisons</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/expand.grid.html'>expand.grid</a></span>(<span class='kw'>land1</span> <span class='kw'>=</span> <span class='no'>lands</span>[<span class='fl'>1</span>:<span class='fl'>6</span>], <span class='kw'>land2</span> <span class='kw'>=</span> <span class='no'>lands</span>[<span class='fl'>7</span>:<span class='fl'>12</span>]),
                          <span class='kw'>stringsAsFactors</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)

<span class='no'>comparisons</span> <span class='kw'>&lt;-</span> <span class='no'>comparisons</span> <span class='kw'>%&gt;%</span> <span class='fu'>mutate</span>(
  <span class='kw'>aligned</span> <span class='kw'>=</span> <span class='kw pkg'>purrr</span><span class='kw ns'>::</span><span class='fu'><a href='https://purrr.tidyverse.org/reference/map2.html'>map2</a></span>(<span class='kw'>.x</span> <span class='kw'>=</span> <span class='no'>land1</span>, <span class='kw'>.y</span> <span class='kw'>=</span> <span class='no'>land2</span>,
                        <span class='kw'>.f</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>xx</span>, <span class='no'>yy</span>) {
                          <span class='no'>land1</span> <span class='kw'>&lt;-</span> <span class='no'>bullets</span>$<span class='no'>sigs</span>[<span class='no'>bullets</span>$<span class='no'>bulletland</span> <span class='kw'>==</span> <span class='no'>xx</span>]<span class='kw'>[[</span><span class='fl'>1</span>]]
                          <span class='no'>land2</span> <span class='kw'>&lt;-</span> <span class='no'>bullets</span>$<span class='no'>sigs</span>[<span class='no'>bullets</span>$<span class='no'>bulletland</span> <span class='kw'>==</span> <span class='no'>yy</span>]<span class='kw'>[[</span><span class='fl'>1</span>]]
                          <span class='no'>land1</span>$<span class='no'>bullet</span> <span class='kw'>&lt;-</span> <span class='st'>"first-land"</span>
                          <span class='no'>land2</span>$<span class='no'>bullet</span> <span class='kw'>&lt;-</span> <span class='st'>"second-land"</span>

                          <span class='fu'><a href='https://rdrr.io/pkg/bulletxtrctr/man/sig_align.html'>sig_align</a></span>(<span class='no'>land1</span>$<span class='no'>sig</span>, <span class='no'>land2</span>$<span class='no'>sig</span>)
                        }))

<span class='no'>comparisons</span> <span class='kw'>&lt;-</span> <span class='no'>comparisons</span> <span class='kw'>%&gt;%</span>
  <span class='fu'>mutate</span>(<span class='kw'>cmps</span> <span class='kw'>=</span> <span class='no'>aligned</span> <span class='kw'>%&gt;%</span> <span class='kw pkg'>purrr</span><span class='kw ns'>::</span><span class='fu'><a href='https://purrr.tidyverse.org/reference/map.html'>map</a></span>(<span class='kw'>.f</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>a</span>) {
    <span class='fu'>extract_feature_cmps</span>(<span class='no'>a</span>$<span class='no'>lands</span>$<span class='no'>sig1</span>, <span class='no'>a</span>$<span class='no'>lands</span>$<span class='no'>sig2</span>, <span class='kw'>full_result</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)
  }))

<span class='co'># comparisons.cmps &lt;- comparisons.cmps %&gt;% </span>
<span class='co'>#   mutate(cmps = aligned %&gt;% purrr::map_dbl(.f = function(a) {</span>
<span class='co'>#     extract_feature_cmps(a$lands$sig1, a$lands$sig2, full_result = FALSE)</span>
<span class='co'>#   }))</span>
<span class='co'># comparisons.cmps %&gt;% select(land1, land2, cmps) </span>

<span class='no'>comparisons</span> <span class='kw'>&lt;-</span> <span class='no'>comparisons</span> <span class='kw'>%&gt;%</span>
  <span class='fu'>mutate</span>(
    <span class='kw'>cmps_score</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span>(<span class='no'>comparisons</span>$<span class='no'>cmps</span>, <span class='kw'>function</span>(<span class='no'>x</span>) <span class='no'>x</span>$<span class='no'>CMPS.score</span>),
    <span class='kw'>cmps_nseg</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span>(<span class='no'>comparisons</span>$<span class='no'>cmps</span>, <span class='kw'>function</span>(<span class='no'>x</span>) <span class='no'>x</span>$<span class='no'>nseg</span>)
  )

<span class='no'>cp1</span> <span class='kw'>&lt;-</span> <span class='no'>comparisons</span> <span class='kw'>%&gt;%</span> <span class='fu'>select</span>(<span class='no'>land1</span>, <span class='no'>land2</span>, <span class='no'>cmps_score</span>, <span class='no'>cmps_nseg</span>)
<span class='no'>cp1</span>
}</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Wangqian Ju.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


